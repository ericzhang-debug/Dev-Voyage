---
title: ç¬¬ 10 ç« ï¼šæƒé™åˆ†çº§ä¸ä¸ªäººä¸­å¿ƒ
createTime: 2025/12/19 12:00:00
permalink: /fullstack-course/permission/
---
# ç¬¬ 10 ç« ï¼šæƒé™åˆ†çº§ä¸ä¸ªäººä¸­å¿ƒ

::: important æœ¬ç« å­¦ä¹ ç›®æ ‡
- ç†è§£æƒé™åˆ†çº§çš„æ¦‚å¿µï¼ˆRBAC æ¨¡å‹ï¼‰
- å®ç°ç”¨æˆ·è§’è‰²ç³»ç»Ÿ
- å­¦ä¹ è·¯ç”±å®ˆå«ä¿æŠ¤é¡µé¢
- åˆ›å»ºä¸ªäººä¸­å¿ƒä¸æ–‡ç« ç®¡ç†
- ğŸ‰ **æˆæœï¼šä¸åŒè§’è‰²æœ‰ä¸åŒèƒ½åŠ›ï¼**
:::

ç”¨æˆ·èƒ½ç™»å½•äº†ï¼Œä½†ç°åœ¨"ç™»å½•"å’Œ"æœªç™»å½•"åªæœ‰ä¸¤ç§çŠ¶æ€ã€‚ç°å®ä¸–ç•Œä¸­ï¼Œä¸åŒç”¨æˆ·åº”è¯¥æœ‰ä¸åŒçš„èƒ½åŠ›â€”â€”æ¸¸å®¢åªèƒ½çœ‹ï¼Œè¯»è€…å¯ä»¥è¯„è®ºï¼Œä½œè€…æ‰èƒ½å‘æ–‡ç« ã€‚è¿™ä¸€ç« æˆ‘ä»¬æ¥å®ç°**æƒé™åˆ†çº§**ï¼

::: tip æœ¬ç« ç»“æŸåä½ ä¼šå¾—åˆ°ä»€ä¹ˆ
ä¸€ä¸ªå®Œæ•´çš„æƒé™ç³»ç»Ÿâ€”â€”æ¸¸å®¢åªèƒ½æµè§ˆï¼Œè¯»è€…å¯ä»¥è¯„è®ºï¼Œä½œè€…å¯ä»¥å‘å¸ƒå’Œç®¡ç†è‡ªå·±çš„æ–‡ç« ï¼
:::

---

## 10.1 ç†è§£æƒé™åˆ†çº§

### 10.1.1 ä¸ºä»€ä¹ˆéœ€è¦æƒé™ï¼Ÿ

::: info å†å²è¶£äº‹ï¼šUnix æ–‡ä»¶æƒé™çš„è¯ç”Ÿ
1969 å¹´ï¼ŒKen Thompson å’Œ Dennis Ritchie åœ¨è´å°”å®éªŒå®¤å¼€å‘ Unix æ—¶ï¼Œé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªç”¨æˆ·å…±ç”¨ä¸€å°è®¡ç®—æœºï¼Œå¦‚ä½•é˜²æ­¢ç”¨æˆ· A åˆ é™¤ç”¨æˆ· B çš„æ–‡ä»¶ï¼Ÿ

ä»–ä»¬è®¾è®¡äº†ç®€å•è€Œä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼š**rwx æƒé™ç³»ç»Ÿ**ã€‚
- **r** (read)ï¼šè¯»å–
- **w** (write)ï¼šå†™å…¥
- **x** (execute)ï¼šæ‰§è¡Œ

æ¯ä¸ªæ–‡ä»¶æœ‰ä¸‰ç»„æƒé™ï¼šæ‰€æœ‰è€…ã€æ‰€å±ç»„ã€å…¶ä»–äººã€‚è¿™ä¸ª 1969 å¹´çš„è®¾è®¡è‡³ä»Šä»åœ¨ä½¿ç”¨ï¼

å½“ä½ åœ¨ç»ˆç«¯è¾“å…¥ `ls -l` çœ‹åˆ° `-rwxr-xr-x` æ—¶ï¼Œä½ çœ‹åˆ°çš„æ­£æ˜¯ 55 å¹´å‰çš„æ™ºæ…§ç»“æ™¶ã€‚
:::

ç›®å‰æˆ‘ä»¬çš„åšå®¢å­˜åœ¨é—®é¢˜ï¼š
- âŒ ä»»ä½•ç™»å½•ç”¨æˆ·éƒ½èƒ½å‘æ–‡ç« 
- âŒ ç”¨æˆ·å¯ä»¥åˆ é™¤åˆ«äººçš„æ–‡ç« ï¼Ÿ
- âŒ æ²¡æœ‰å†…å®¹å®¡æ ¸æœºåˆ¶

### 10.1.2 å¸¸è§æƒé™æ¨¡å‹

| æ¨¡å‹ | å…¨ç§° | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **ACL** | Access Control List | ç›´æ¥ç»™ç”¨æˆ·åˆ†é…æƒé™ | ç®€å•ç³»ç»Ÿ |
| **RBAC** | Role-Based Access Control | ç”¨æˆ· â†’ è§’è‰² â†’ æƒé™ | ä¼ä¸šåº”ç”¨ |
| **ABAC** | Attribute-Based Access Control | åŸºäºå±æ€§çš„åŠ¨æ€æƒé™ | å¤æ‚ç­–ç•¥ |

::: info å†å²è¶£äº‹ï¼šRBAC çš„è¯ç”Ÿ
1992 å¹´ï¼Œç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶é™¢ï¼ˆNISTï¼‰çš„ David Ferraiolo å’Œ Richard Kuhn å‘è¡¨äº†è‘—åè®ºæ–‡ã€ŠRole-Based Access Controlsã€‹ï¼Œæ­£å¼æå‡ºäº† RBAC æ¨¡å‹ã€‚

ä»–ä»¬è§‚å¯Ÿåˆ°ä¸€ä¸ªç°è±¡ï¼šä¼ä¸šé‡Œçš„æƒé™ç®¡ç†éå¸¸æ··ä¹±â€”â€”æ¯ä¸ªå‘˜å·¥éƒ½æœ‰ç‹¬ç«‹çš„æƒé™åˆ—è¡¨ï¼Œæ–°å‘˜å·¥å…¥èŒè¦é…ç½®å‡ åé¡¹æƒé™ï¼Œå‘˜å·¥ç¦»èŒè¦ä¸€ä¸€æ’¤é”€ã€‚

RBAC çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**ä¸è¦ç»™ç”¨æˆ·åˆ†é…æƒé™ï¼Œç»™è§’è‰²åˆ†é…æƒé™ï¼Œå†æŠŠè§’è‰²åˆ†é…ç»™ç”¨æˆ·**ã€‚

æ–°å‘˜å·¥å…¥èŒï¼Ÿç»™ä»–ä¸€ä¸ª"æ™®é€šå‘˜å·¥"è§’è‰²å°±è¡Œã€‚å‡èŒäº†ï¼Ÿæ¢æˆ"ç»ç†"è§’è‰²ã€‚ç®€å•åˆæ¸…æ™°ï¼

å¦‚ä»Šï¼Œå‡ ä¹æ‰€æœ‰çš„æƒé™ç³»ç»Ÿéƒ½é‡‡ç”¨ RBAC æˆ–å…¶å˜ä½“ã€‚
:::

æˆ‘ä»¬çš„åšå®¢å°†é‡‡ç”¨ **RBAC æ¨¡å‹**ï¼Œå› ä¸ºå®ƒç®€å•ä¸”å¤Ÿç”¨ã€‚

### 10.1.3 æˆ‘ä»¬çš„åšå®¢æƒé™è®¾è®¡

<svg width="600" height="400" xmlns="http://www.w3.org/2000/svg">
  
  <!-- ç»§æ‰¿ç®­å¤´ -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>
  
  <!-- æƒé™å±‚çº§ -->
  
  <!-- Level 0: æ¸¸å®¢ -->
  <rect x="50" y="50" width="500" height="80" rx="8" fill="#f9f9f9" stroke="#333" stroke-width="2"/>
  <text x="300" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">Level 0: æ¸¸å®¢ (Guest)</text>
  
  <!-- æ¸¸å®¢æƒé™ -->
  <g transform="translate(70, 90)">
    <rect x="0" y="0" width="110" height="30" rx="4" fill="#f5f5f5" stroke="#999" stroke-width="1"/>
    <text x="55" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">æµè§ˆæ–‡ç« åˆ—è¡¨</text>
  </g>
  
  <g transform="translate(190, 90)">
    <rect x="0" y="0" width="110" height="30" rx="4" fill="#f5f5f5" stroke="#999" stroke-width="1"/>
    <text x="55" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">æŸ¥çœ‹æ–‡ç« è¯¦æƒ…</text>
  </g>
  
  <g transform="translate(310, 90)">
    <rect x="0" y="0" width="110" height="30" rx="4" fill="#f5f5f5" stroke="#999" stroke-width="1"/>
    <text x="55" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">ä¸èƒ½è¯„è®º</text>
  </g>
  
  <g transform="translate(430, 90)">
    <rect x="0" y="0" width="110" height="30" rx="4" fill="#f5f5f5" stroke="#999" stroke-width="1"/>
    <text x="55" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">ä¸èƒ½å‘æ–‡ç« </text>
  </g>
  
  <!-- ç»§æ‰¿ç®­å¤´ 1 -->
  <line x1="300" y1="130" x2="300" y2="150" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Level 1: è¯»è€… -->
  <rect x="50" y="150" width="500" height="80" rx="8" fill="#e6f3ff" stroke="#0066cc" stroke-width="2"/>
  <text x="300" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#0066cc">Level 1: è¯»è€… (Reader) - ç»§æ‰¿æ¸¸å®¢æ‰€æœ‰èƒ½åŠ›</text>
  
  <!-- è¯»è€…æƒé™ -->
  <g transform="translate(200, 190)">
    <rect x="0" y="0" width="110" height="30" rx="4" fill="#e6f3ff" stroke="#66aaff" stroke-width="1"/>
    <text x="55" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#0066cc">è¯„è®ºæ–‡ç« </text>
  </g>
  
  <g transform="translate(320, 190)">
    <rect x="0" y="0" width="110" height="30" rx="4" fill="#e6f3ff" stroke="#66aaff" stroke-width="1"/>
    <text x="55" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#0066cc">ç‚¹èµ</text>
  </g>
  
  <!-- ç»§æ‰¿ç®­å¤´ 2 -->
  <line x1="300" y1="230" x2="300" y2="250" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Level 2: ä½œè€… -->
  <rect x="50" y="250" width="500" height="80" rx="8" fill="#e6ffe6" stroke="#009900" stroke-width="2"/>
  <text x="300" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#009900">Level 2: ä½œè€… (Author) - ç»§æ‰¿è¯»è€…æ‰€æœ‰èƒ½åŠ›</text>
  
  <!-- ä½œè€…æƒé™ -->
  <g transform="translate(200, 290)">
    <rect x="0" y="0" width="110" height="30" rx="4" fill="#e6ffe6" stroke="#66cc66" stroke-width="1"/>
    <text x="55" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#009900">å‘å¸ƒæ–‡ç« </text>
  </g>
  
  <g transform="translate(320, 290)">
    <rect x="0" y="0" width="110" height="30" rx="4" fill="#e6ffe6" stroke="#66cc66" stroke-width="1"/>
    <text x="55" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#009900">ç¼–è¾‘/åˆ é™¤æ–‡ç« </text>
  </g>
  
  <!-- è¯´æ˜æ–‡å­— -->
  <text x="300" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">æƒé™ç»§æ‰¿å…³ç³»ï¼šæ¸¸å®¢ â†’ è¯»è€… â†’ ä½œè€…</text>
</svg>

::: tip ä¸ºä»€ä¹ˆä¸ä¸€å¼€å§‹å°±è®¾è®¡ç®¡ç†å‘˜ï¼Ÿ
éµå¾ª"æœ€å°å¯è¡Œäº§å“"åŸåˆ™â€”â€”å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†é€æ­¥æ‰©å±•ã€‚ç®¡ç†å‘˜è§’è‰²å¯ä»¥ä½œä¸ºç»ƒä¹ é¢˜ï¼
:::

## 10.2 åç«¯ï¼šç”¨æˆ·è§’è‰²ç³»ç»Ÿ

### 10.2.1 ç»™ User æ¨¡å‹æ·»åŠ  role å­—æ®µ

ä¿®æ”¹ `backend/src/backend/models.py`ï¼š

```python
# backend/src/backend/models.py
from sqlalchemy import Column, Integer, String, Text, ForeignKey, Enum
from sqlalchemy.orm import relationship
from .database import Base
import enum


class UserRole(str, enum.Enum):
    """ç”¨æˆ·è§’è‰²æšä¸¾"""
    reader = "reader"   # è¯»è€…ï¼ˆé»˜è®¤ï¼‰
    author = "author"   # ä½œè€…


class User(Base):
    """ç”¨æˆ·æ¨¡å‹"""
    __tablename__ = "users"

    id = Column(Integer, primary_key=True, index=True)
    username = Column(String(50), unique=True, nullable=False, index=True)
    email = Column(String(100), unique=True, nullable=False, index=True)
    hashed_password = Column(String(200), nullable=False)
    created_at = Column(String(20))
    avatar = Column(String(500), default="")
    
    # æ–°å¢ï¼šç”¨æˆ·è§’è‰²
    role = Column(String(20), default=UserRole.reader.value)

    articles = relationship("Article", back_populates="user")

    def to_dict(self):
        return {
            "id": self.id,
            "username": self.username,
            "email": self.email,
            "created_at": self.created_at,
            "avatar": self.avatar,
            "role": self.role  # è¿”å›è§’è‰²ä¿¡æ¯
        }
    
    def has_permission(self, required_role: str) -> bool:
        """æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æŸä¸ªè§’è‰²çš„æƒé™"""
        role_levels = {
            "reader": 1,
            "author": 2,
        }
        return role_levels.get(self.role, 0) >= role_levels.get(required_role, 0)
```

::: note ä¸ºä»€ä¹ˆç”¨å­—ç¬¦ä¸²è€Œä¸æ˜¯æšä¸¾ç±»å‹ï¼Ÿ
SQLite å¯¹æšä¸¾ç±»å‹çš„æ”¯æŒæœ‰é™ã€‚ä½¿ç”¨å­—ç¬¦ä¸²å­˜å‚¨æ›´ç®€å•ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨ Python ä»£ç ä¸­ä»ç„¶ç”¨ `UserRole` æšä¸¾æ¥ä¿è¯ç±»å‹å®‰å…¨ã€‚
:::

### 10.2.2 æ›´æ–° Schema

ä¿®æ”¹ `backend/src/backend/schemas.py`ï¼Œæ·»åŠ è§’è‰²ç›¸å…³å†…å®¹ï¼š

```python
# åœ¨ schemas.py ä¸­æ·»åŠ 

from typing import Literal

class UserResponse(BaseModel):
    """ç”¨æˆ·ä¿¡æ¯å“åº”"""
    id: int
    username: str
    email: str
    created_at: str
    avatar: str
    role: str  # æ–°å¢


class RoleUpdateRequest(BaseModel):
    """è§’è‰²æ›´æ–°è¯·æ±‚"""
    role: Literal["reader", "author"]
```

### 10.2.3 åˆ›å»ºæƒé™æ£€æŸ¥è£…é¥°å™¨

åœ¨ `backend/src/backend/auth.py` ä¸­æ·»åŠ æƒé™æ£€æŸ¥åŠŸèƒ½ï¼š

```python
# åœ¨ auth.py æœ«å°¾æ·»åŠ 

from functools import wraps
from .models import UserRole


def require_role(required_role: str):
    """
    æƒé™æ£€æŸ¥è£…é¥°å™¨å·¥å‚
    ç”¨æ³•ï¼š@require_role("author")
    """
    async def role_checker(
        current_user: User = Depends(get_current_user_required)
    ) -> User:
        if not current_user.has_permission(required_role):
            raise HTTPException(
                status_code=status.HTTP_403_FORBIDDEN,
                detail=f"æƒé™ä¸è¶³ï¼Œéœ€è¦ {required_role} è§’è‰²"
            )
        return current_user
    
    return role_checker


# é¢„å®šä¹‰çš„è§’è‰²æ£€æŸ¥å™¨
require_reader = require_role("reader")
require_author = require_role("author")
```

::: tip 403 vs 401 çš„åŒºåˆ«
- **401 Unauthorized**ï¼šæœªè®¤è¯ï¼ˆæ²¡ç™»å½•ï¼‰
- **403 Forbidden**ï¼šå·²è®¤è¯ä½†æ— æƒé™ï¼ˆç™»å½•äº†ä½†æƒé™ä¸å¤Ÿï¼‰

è¿™ä¸¤ä¸ª HTTP çŠ¶æ€ç çš„å‘½åæœ‰ç‚¹åç›´è§‰ï¼Œä½†è¿™æ˜¯å†å²é—ç•™é—®é¢˜ã€‚
:::

### 10.2.4 ä¿®æ”¹å‘å¸ƒæ–‡ç«  API

ç°åœ¨è®©æˆ‘ä»¬ç”¨æƒé™æ£€æŸ¥æ¥ä¿æŠ¤å‘å¸ƒæ–‡ç« çš„ APIã€‚ä¿®æ”¹ `backend/src/backend/__init__.py`ï¼š

```python
# ä¿®æ”¹å‘å¸ƒæ–‡ç«  API
from .auth import get_current_user_required, require_author

@app.post("/api/articles")
def create_article(
    article: ArticleCreate, 
    db: Session = Depends(get_db),
    current_user: User = Depends(require_author)  # éœ€è¦ä½œè€…æƒé™ï¼
):
    """å‘å¸ƒæ–°æ–‡ç« ï¼ˆéœ€è¦ä½œè€…æƒé™ï¼‰"""
    db_article = Article(
        title=article.title,
        summary=article.summary or article.content[:100] + "...",
        content=article.content,
        author=current_user.username,
        created_at=datetime.now().strftime("%Y-%m-%d"),
        tags=article.tags,
        user_id=current_user.id
    )
    
    db.add(db_article)
    db.commit()
    db.refresh(db_article)
    
    return {
        "message": "å‘å¸ƒæˆåŠŸ",
        "article": db_article.to_dict()
    }
```

::: warning å‰ç«¯æƒé™æ£€æŸ¥åªæ˜¯ä½“éªŒä¼˜åŒ–ï¼
æœ‰äº›åŒå­¦å¯èƒ½ä¼šé—®ï¼šå‰ç«¯ä¹Ÿåšäº†æƒé™æ£€æŸ¥ï¼Œåç«¯è¿˜éœ€è¦å—ï¼Ÿ

**ç­”æ¡ˆæ˜¯å¿…é¡»çš„ï¼**

å‰ç«¯çš„æƒé™æ£€æŸ¥åªæ˜¯ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼ˆä¸è®©ç”¨æˆ·çœ‹åˆ°ä»–æ— æƒè®¿é—®çš„æŒ‰é’®ï¼‰ï¼Œä½†å‰ç«¯ä»£ç æ˜¯å¯ä»¥è¢«ç¯¡æ”¹çš„ã€‚çœŸæ­£çš„å®‰å…¨å¿…é¡»é åç«¯ä¿éšœã€‚

è¿™å°±æ˜¯æ‰€è°“çš„"å‰ç«¯åšä½“éªŒï¼Œåç«¯åšå®‰å…¨"ã€‚
:::

### 10.2.5 æ·»åŠ è§’è‰²å‡çº§ API

ç”¨æˆ·æ³¨å†Œæ—¶é»˜è®¤æ˜¯ readerï¼Œå¦‚ä½•æˆä¸º authorï¼Ÿæˆ‘ä»¬æä¾›ä¸€ä¸ªç®€å•çš„"ç”³è¯·æˆä¸ºä½œè€…"APIï¼š

```python
# åœ¨ __init__.py ä¸­æ·»åŠ 

@app.post("/api/users/become-author")
def become_author(
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_user_required)
):
    """ç”³è¯·æˆä¸ºä½œè€…"""
    if current_user.role == UserRole.author.value:
        raise HTTPException(status_code=400, detail="ä½ å·²ç»æ˜¯ä½œè€…äº†")
    
    current_user.role = UserRole.author.value
    db.commit()
    
    return {
        "message": "æ­å–œï¼ä½ ç°åœ¨æ˜¯ä½œè€…äº†ï¼Œå¯ä»¥å‘å¸ƒæ–‡ç« å•¦ï¼",
        "user": current_user.to_dict()
    }
```

::: note çœŸå®åœºæ™¯ä¸‹çš„è§’è‰²ç®¡ç†
åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œè§’è‰²å‡çº§é€šå¸¸éœ€è¦å®¡æ ¸æµç¨‹ï¼Œæ¯”å¦‚ï¼š
- æäº¤ç”³è¯· â†’ ç®¡ç†å‘˜å®¡æ ¸ â†’ é€šè¿‡/æ‹’ç»
- æˆ–è€…æ»¡è¶³æŸäº›æ¡ä»¶è‡ªåŠ¨å‡çº§ï¼ˆå‘è¡¨è¯„è®ºæ•°è¾¾åˆ° 10 æ¡ï¼‰

è¿™é‡Œä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬ç›´æ¥è®©ç”¨æˆ·"è‡ªåŠ©å‡çº§"ã€‚
:::

## 10.3 å‰ç«¯ï¼šè·¯ç”±å®ˆå«

### 10.3.1 ä»€ä¹ˆæ˜¯è·¯ç”±å®ˆå«ï¼Ÿ

è·¯ç”±å®ˆå«å°±æ˜¯åœ¨è¿›å…¥æŸä¸ªé¡µé¢ä¹‹å‰çš„"å®‰æ£€å‘˜"â€”â€”æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®è¿™ä¸ªé¡µé¢ã€‚

```mermaid
flowchart TD
    A[ç”¨æˆ·ç‚¹å‡»å‘å¸ƒæ–‡ç« ] --> B[è·¯ç”±å®ˆå«æ£€æŸ¥]
    B --> C{å·²ç™»å½•ä¸”æ˜¯ä½œè€…è§’è‰²?}
    C -->|æ˜¯| D[å…è®¸è¿›å…¥å‘å¸ƒé¡µ]
    C -->|å¦| E[è·³è½¬åˆ°ç™»å½•é¡µæˆ–æç¤ºæ— æƒé™]
```

### 10.3.2 Nuxt ä¸­é—´ä»¶æœºåˆ¶

åœ¨ Nuxt ä¸­ï¼Œè·¯ç”±å®ˆå«é€šè¿‡ **middlewareï¼ˆä¸­é—´ä»¶ï¼‰** å®ç°ã€‚ä¸­é—´ä»¶æ˜¯åœ¨é¡µé¢æ¸²æŸ“ä¹‹å‰æ‰§è¡Œçš„å‡½æ•°ã€‚

ä¸­é—´ä»¶å¯ä»¥æ˜¯ï¼š
- **å…¨å±€ä¸­é—´ä»¶**ï¼šæ¯æ¬¡è·¯ç”±å˜åŒ–éƒ½æ‰§è¡Œ
- **é¡µé¢ä¸­é—´ä»¶**ï¼šåªåœ¨ç‰¹å®šé¡µé¢æ‰§è¡Œ

### 10.3.3 åˆ›å»º auth ä¸­é—´ä»¶

åœ¨ `frontend/app/middleware/` ç›®å½•ä¸‹åˆ›å»º `auth.ts`ï¼š

```typescript
// frontend/app/middleware/auth.ts
export default defineNuxtRouteMiddleware((to, from) => {
  const { isLoggedIn } = useAuth()
  
  // å¦‚æœæœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
  if (!isLoggedIn.value) {
    return navigateTo({
      path: '/auth/login',
      query: { redirect: to.fullPath }  // è®°å½•åŸæœ¬è¦å»çš„é¡µé¢
    })
  }
})
```

### 10.3.4 åˆ›å»º role ä¸­é—´ä»¶

åˆ›å»º `frontend/app/middleware/author.ts`ï¼š

```typescript
// frontend/app/middleware/author.ts
export default defineNuxtRouteMiddleware((to, from) => {
  const { user, isLoggedIn } = useAuth()
  
  // å…ˆæ£€æŸ¥æ˜¯å¦ç™»å½•
  if (!isLoggedIn.value) {
    return navigateTo({
      path: '/auth/login',
      query: { redirect: to.fullPath }
    })
  }
  
  // å†æ£€æŸ¥æ˜¯å¦æ˜¯ä½œè€…
  if (user.value?.role !== 'author') {
    // å¯ä»¥è·³è½¬åˆ°æç¤ºé¡µé¢ï¼Œæˆ–è€…è¿”å›ä¸Šä¸€é¡µ
    return navigateTo({
      path: '/user',
      query: { message: 'need-author' }  // æç¤ºéœ€è¦æˆä¸ºä½œè€…
    })
  }
})
```

### 10.3.5 ä¿æŠ¤å‘å¸ƒé¡µé¢

ä¿®æ”¹ `frontend/app/pages/blog/publish.vue`ï¼Œæ·»åŠ ä¸­é—´ä»¶ï¼š

```vue
<!-- frontend/app/pages/blog/publish.vue -->
<script setup>
// ä½¿ç”¨ author ä¸­é—´ä»¶ä¿æŠ¤æ­¤é¡µé¢
definePageMeta({
  middleware: ['author']
})

// ... å…¶ä»–ä»£ç ä¿æŒä¸å˜
</script>
```

::: tip definePageMeta çš„ä½œç”¨
`definePageMeta` æ˜¯ Nuxt 3 çš„å®ï¼Œç”¨äºå®šä¹‰é¡µé¢çº§åˆ«çš„å…ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- `middleware`ï¼šé¡µé¢ä¸­é—´ä»¶
- `layout`ï¼šä½¿ç”¨çš„å¸ƒå±€
- `title`ï¼šé¡µé¢æ ‡é¢˜
:::

## 10.4 ä¸ªäººä¸­å¿ƒé¡µé¢

### 10.4.1 åˆ›å»ºæƒé™å·¥å…· composable

åˆ›å»º `frontend/app/composables/usePermission.ts`ï¼š

```typescript
// frontend/app/composables/usePermission.ts
export const usePermission = () => {
  const { user, isLoggedIn } = useAuth()
  
  // æ£€æŸ¥æ˜¯å¦æœ‰æŸä¸ªè§’è‰²
  const hasRole = (role: string) => {
    if (!isLoggedIn.value || !user.value) return false
    
    const roleLevels: Record<string, number> = {
      reader: 1,
      author: 2,
    }
    
    const userLevel = roleLevels[user.value.role] || 0
    const requiredLevel = roleLevels[role] || 0
    
    return userLevel >= requiredLevel
  }
  
  // å¸¸ç”¨æƒé™æ£€æŸ¥
  const canComment = computed(() => isLoggedIn.value)
  const canPublish = computed(() => hasRole('author'))
  const isAuthor = computed(() => user.value?.role === 'author')
  
  // æ£€æŸ¥æ˜¯å¦æ˜¯æŸç¯‡æ–‡ç« çš„æ‰€æœ‰è€…
  const isOwner = (articleUserId: number) => {
    return user.value?.id === articleUserId
  }
  
  return {
    hasRole,
    canComment,
    canPublish,
    isAuthor,
    isOwner
  }
}
```

### 10.4.2 åˆ›å»ºä¸ªäººä¸­å¿ƒè·¯ç”±

åˆ›å»º `frontend/app/pages/user/index.vue`ï¼š

```vue
<!-- frontend/app/pages/user/index.vue -->
<template>
  <div class="user-center">
    <div class="profile-header">
      <div class="avatar-section">
        <div class="avatar">
          {{ user?.username?.charAt(0).toUpperCase() }}
        </div>
        <div class="user-info">
          <h1 class="username">{{ user?.username }}</h1>
          <span class="role-badge" :class="user?.role">
            {{ roleLabel }}
          </span>
        </div>
      </div>
      
      <div class="user-meta">
        <p>ğŸ“§ {{ user?.email }}</p>
        <p>ğŸ“… æ³¨å†Œäº {{ user?.created_at }}</p>
      </div>
    </div>
    
    <!-- æç¤ºæ¶ˆæ¯ -->
    <div v-if="needAuthorMessage" class="tip-banner warning">
      âš ï¸ ä½ éœ€è¦æˆä¸ºä½œè€…æ‰èƒ½å‘å¸ƒæ–‡ç« ã€‚
      <button @click="becomeAuthor" class="btn-small">ç«‹å³æˆä¸ºä½œè€…</button>
    </div>
    
    <!-- åŠŸèƒ½å…¥å£ -->
    <div class="feature-cards">
      <NuxtLink to="/user/articles" class="feature-card">
        <span class="icon">ğŸ“</span>
        <span class="title">æˆ‘çš„æ–‡ç« </span>
        <span class="desc">æŸ¥çœ‹å’Œç®¡ç†ä½ å‘å¸ƒçš„æ–‡ç« </span>
      </NuxtLink>
      
      <div 
        v-if="!isAuthor" 
        class="feature-card action"
        @click="becomeAuthor"
      >
        <span class="icon">âœ¨</span>
        <span class="title">æˆä¸ºä½œè€…</span>
        <span class="desc">è·å¾—å‘å¸ƒæ–‡ç« çš„æƒé™</span>
      </div>
      
      <NuxtLink 
        v-if="canPublish" 
        to="/blog/publish" 
        class="feature-card"
      >
        <span class="icon">ğŸš€</span>
        <span class="title">å‘å¸ƒæ–‡ç« </span>
        <span class="desc">åˆ†äº«ä½ çš„æƒ³æ³•å’ŒçŸ¥è¯†</span>
      </NuxtLink>
    </div>
  </div>
</template>

<script setup>
definePageMeta({
  middleware: ['auth']  // éœ€è¦ç™»å½•
})

const route = useRoute()
const { user, token } = useAuth()
const { canPublish, isAuthor } = usePermission()

// æ£€æŸ¥æ˜¯å¦æœ‰æç¤ºæ¶ˆæ¯
const needAuthorMessage = computed(() => route.query.message === 'need-author')

// è§’è‰²æ ‡ç­¾
const roleLabel = computed(() => {
  const labels = {
    reader: 'ğŸ“– è¯»è€…',
    author: 'âœï¸ ä½œè€…',
  }
  return labels[user.value?.role] || 'ç”¨æˆ·'
})

// æˆä¸ºä½œè€…
async function becomeAuthor() {
  try {
    const response = await $fetch('http://localhost:8000/api/users/become-author', {
      method: 'POST',
      headers: {
        Authorization: `Bearer ${token.value}`
      }
    })
    
    // æ›´æ–°æœ¬åœ°ç”¨æˆ·ä¿¡æ¯
    if (user.value) {
      user.value.role = 'author'
      localStorage.setItem('user', JSON.stringify(user.value))
    }
    
    alert('ğŸ‰ ' + response.message)
  } catch (error) {
    alert('æ“ä½œå¤±è´¥ï¼š' + (error.data?.detail || 'æœªçŸ¥é”™è¯¯'))
  }
}
</script>

<style scoped>
.user-center {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

.profile-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 1rem;
  padding: 2rem;
  color: white;
  margin-bottom: 2rem;
}

.avatar-section {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  margin-bottom: 1rem;
}

.avatar {
  width: 80px;
  height: 80px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  font-weight: bold;
}

.username {
  font-size: 1.75rem;
  margin: 0 0 0.5rem 0;
}

.role-badge {
  display: inline-block;
  padding: 0.25rem 0.75rem;
  border-radius: 1rem;
  font-size: 0.875rem;
  background: rgba(255, 255, 255, 0.2);
}

.role-badge.author {
  background: rgba(255, 215, 0, 0.3);
}

.user-meta {
  opacity: 0.9;
  font-size: 0.9rem;
}

.user-meta p {
  margin: 0.25rem 0;
}

.tip-banner {
  padding: 1rem;
  border-radius: 0.5rem;
  margin-bottom: 2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.tip-banner.warning {
  background: #fef3cd;
  color: #856404;
}

.btn-small {
  padding: 0.5rem 1rem;
  background: #856404;
  color: white;
  border: none;
  border-radius: 0.25rem;
  cursor: pointer;
}

.feature-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.feature-card {
  background: white;
  border: 2px solid #e5e7eb;
  border-radius: 1rem;
  padding: 1.5rem;
  text-decoration: none;
  color: inherit;
  display: flex;
  flex-direction: column;
  transition: all 0.2s;
}

.feature-card:hover {
  border-color: #667eea;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.feature-card.action {
  cursor: pointer;
  border-style: dashed;
}

.feature-card .icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.feature-card .title {
  font-weight: 600;
  font-size: 1.1rem;
  margin-bottom: 0.25rem;
}

.feature-card .desc {
  font-size: 0.875rem;
  color: #6b7280;
}
</style>
```

## 10.5 æˆ‘çš„æ–‡ç« ç®¡ç†

### 10.5.1 åç«¯ï¼šè·å–ç”¨æˆ·æ–‡ç«  API

åœ¨ `backend/src/backend/__init__.py` ä¸­æ·»åŠ ï¼š

```python
@app.get("/api/users/me/articles")
def get_my_articles(
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_user_required)
):
    """è·å–å½“å‰ç”¨æˆ·çš„æ–‡ç« åˆ—è¡¨"""
    articles = db.query(Article).filter(
        Article.user_id == current_user.id
    ).order_by(Article.id.desc()).all()
    
    return {
        "articles": [article.to_dict() for article in articles],
        "total": len(articles)
    }
```

### 10.5.2 å‰ç«¯ï¼šæˆ‘çš„æ–‡ç« åˆ—è¡¨

åˆ›å»º `frontend/app/pages/user/articles.vue`ï¼š

```vue
<!-- frontend/app/pages/user/articles.vue -->
<template>
  <div class="my-articles">
    <div class="page-header">
      <h1>ğŸ“ æˆ‘çš„æ–‡ç« </h1>
      <NuxtLink v-if="canPublish" to="/blog/publish" class="btn-publish">
        âœï¸ å†™æ–°æ–‡ç« 
      </NuxtLink>
    </div>
    
    <!-- åŠ è½½ä¸­ -->
    <div v-if="pending" class="loading">
      åŠ è½½ä¸­...
    </div>
    
    <!-- æ–‡ç« åˆ—è¡¨ -->
    <div v-else-if="articles.length > 0" class="article-list">
      <div 
        v-for="article in articles" 
        :key="article.id" 
        class="article-item"
      >
        <div class="article-info">
          <NuxtLink :to="`/blog/${article.id}`" class="article-title">
            {{ article.title }}
          </NuxtLink>
          <p class="article-meta">
            å‘å¸ƒäº {{ article.created_at }}
          </p>
        </div>
        
        <div class="article-actions">
          <NuxtLink :to="`/blog/edit/${article.id}`" class="btn-edit">
            âœï¸ ç¼–è¾‘
          </NuxtLink>
          <button @click="confirmDelete(article)" class="btn-delete">
            ğŸ—‘ï¸ åˆ é™¤
          </button>
        </div>
      </div>
    </div>
    
    <!-- ç©ºçŠ¶æ€ -->
    <div v-else class="empty-state">
      <p class="empty-icon">ğŸ“­</p>
      <p class="empty-text">ä½ è¿˜æ²¡æœ‰å‘å¸ƒè¿‡æ–‡ç« </p>
      <NuxtLink v-if="canPublish" to="/blog/publish" class="btn-publish">
        å‘å¸ƒç¬¬ä¸€ç¯‡æ–‡ç« 
      </NuxtLink>
      <button v-else @click="becomeAuthor" class="btn-publish">
        æˆä¸ºä½œè€…ï¼Œå¼€å§‹åˆ›ä½œ
      </button>
    </div>
    
    <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
    <div v-if="showDeleteModal" class="modal-overlay" @click="showDeleteModal = false">
      <div class="modal-content" @click.stop>
        <h3>ç¡®è®¤åˆ é™¤</h3>
        <p>ç¡®å®šè¦åˆ é™¤æ–‡ç« ã€Œ{{ articleToDelete?.title }}ã€å—ï¼Ÿ</p>
        <p class="warning-text">âš ï¸ æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼</p>
        <div class="modal-actions">
          <button @click="showDeleteModal = false" class="btn-cancel">å–æ¶ˆ</button>
          <button @click="deleteArticle" class="btn-confirm-delete">ç¡®è®¤åˆ é™¤</button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
definePageMeta({
  middleware: ['auth']
})

const { token, user } = useAuth()
const { canPublish } = usePermission()

// è·å–æ–‡ç« åˆ—è¡¨
const { data, pending, refresh } = await useFetch('http://localhost:8000/api/users/me/articles', {
  headers: {
    Authorization: `Bearer ${token.value}`
  }
})

const articles = computed(() => data.value?.articles || [])

// åˆ é™¤ç›¸å…³
const showDeleteModal = ref(false)
const articleToDelete = ref(null)

function confirmDelete(article) {
  articleToDelete.value = article
  showDeleteModal.value = true
}

async function deleteArticle() {
  if (!articleToDelete.value) return
  
  try {
    await $fetch(`http://localhost:8000/api/articles/${articleToDelete.value.id}`, {
      method: 'DELETE',
      headers: {
        Authorization: `Bearer ${token.value}`
      }
    })
    
    showDeleteModal.value = false
    articleToDelete.value = null
    refresh()  // åˆ·æ–°åˆ—è¡¨
  } catch (error) {
    alert('åˆ é™¤å¤±è´¥ï¼š' + (error.data?.detail || 'æœªçŸ¥é”™è¯¯'))
  }
}

// æˆä¸ºä½œè€…
async function becomeAuthor() {
  try {
    await $fetch('http://localhost:8000/api/users/become-author', {
      method: 'POST',
      headers: {
        Authorization: `Bearer ${token.value}`
      }
    })
    
    if (user.value) {
      user.value.role = 'author'
      localStorage.setItem('user', JSON.stringify(user.value))
    }
    
    alert('ğŸ‰ ä½ ç°åœ¨æ˜¯ä½œè€…äº†ï¼')
  } catch (error) {
    alert('æ“ä½œå¤±è´¥')
  }
}
</script>

<style scoped>
.my-articles {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.page-header h1 {
  margin: 0;
}

.btn-publish {
  padding: 0.75rem 1.5rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  text-decoration: none;
  border-radius: 0.5rem;
  border: none;
  cursor: pointer;
  font-weight: 500;
}

.loading {
  text-align: center;
  padding: 3rem;
  color: #6b7280;
}

.article-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.article-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.25rem;
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 0.75rem;
  transition: box-shadow 0.2s;
}

.article-item:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.article-title {
  font-weight: 600;
  color: #1a202c;
  text-decoration: none;
  font-size: 1.1rem;
}

.article-title:hover {
  color: #667eea;
}

.article-meta {
  font-size: 0.875rem;
  color: #6b7280;
  margin-top: 0.25rem;
}

.article-actions {
  display: flex;
  gap: 0.5rem;
}

.btn-edit,
.btn-delete {
  padding: 0.5rem 1rem;
  border-radius: 0.375rem;
  font-size: 0.875rem;
  cursor: pointer;
  border: none;
  text-decoration: none;
}

.btn-edit {
  background: #e5e7eb;
  color: #374151;
}

.btn-delete {
  background: #fee2e2;
  color: #dc2626;
}

.empty-state {
  text-align: center;
  padding: 4rem 2rem;
}

.empty-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.empty-text {
  color: #6b7280;
  margin-bottom: 1.5rem;
}

/* æ¨¡æ€æ¡†æ ·å¼ */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: white;
  padding: 2rem;
  border-radius: 1rem;
  max-width: 400px;
  width: 90%;
}

.modal-content h3 {
  margin-top: 0;
}

.warning-text {
  color: #dc2626;
  font-size: 0.875rem;
}

.modal-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
}

.btn-cancel {
  flex: 1;
  padding: 0.75rem;
  background: #e5e7eb;
  border: none;
  border-radius: 0.5rem;
  cursor: pointer;
}

.btn-confirm-delete {
  flex: 1;
  padding: 0.75rem;
  background: #dc2626;
  color: white;
  border: none;
  border-radius: 0.5rem;
  cursor: pointer;
}
</style>
```

## 10.6 ç¼–è¾‘ä¸åˆ é™¤æ–‡ç« 

### 10.6.1 åç«¯ï¼šæ›´æ–°æ–‡ç«  APIï¼ˆPUT æ–¹æ³•ï¼‰

::: info HTTP æ–¹æ³•ä¸ CRUD çš„å¯¹åº”
| æ“ä½œ | HTTP æ–¹æ³• | è¯´æ˜ |
|------|-----------|------|
| Create | POST | åˆ›å»ºæ–°èµ„æº |
| Read | GET | è¯»å–èµ„æº |
| Update | PUT / PATCH | æ›´æ–°èµ„æº |
| Delete | DELETE | åˆ é™¤èµ„æº |

PUT å’Œ PATCH çš„åŒºåˆ«ï¼š
- **PUT**ï¼šå®Œæ•´æ›¿æ¢èµ„æº
- **PATCH**ï¼šéƒ¨åˆ†æ›´æ–°èµ„æº

æˆ‘ä»¬ä½¿ç”¨ PUTï¼Œå› ä¸ºç¼–è¾‘æ—¶ä¼šæäº¤å®Œæ•´çš„æ–‡ç« å†…å®¹ã€‚
:::

åœ¨ `backend/src/backend/__init__.py` ä¸­æ·»åŠ ï¼š

```python
@app.put("/api/articles/{article_id}")
def update_article(
    article_id: int,
    article_data: ArticleCreate,
    db: Session = Depends(get_db),
    current_user: User = Depends(require_author)  # éœ€è¦ä½œè€…æƒé™
):
    """æ›´æ–°æ–‡ç« """
    # æŸ¥æ‰¾æ–‡ç« 
    article = db.query(Article).filter(Article.id == article_id).first()
    if not article:
        raise HTTPException(status_code=404, detail="æ–‡ç« ä¸å­˜åœ¨")
    
    # æ£€æŸ¥æ‰€æœ‰æƒ
    if article.user_id != current_user.id:
        raise HTTPException(status_code=403, detail="ä½ åªèƒ½ç¼–è¾‘è‡ªå·±çš„æ–‡ç« ")
    
    # æ›´æ–°å­—æ®µ
    article.title = article_data.title
    article.content = article_data.content
    article.summary = article_data.summary or article_data.content[:100] + "..."
    article.tags = article_data.tags
    
    db.commit()
    db.refresh(article)
    
    return {
        "message": "æ›´æ–°æˆåŠŸ",
        "article": article.to_dict()
    }
```

::: caution æƒé™åŒé‡éªŒè¯
æ³¨æ„æˆ‘ä»¬åšäº†ä¸¤å±‚æ£€æŸ¥ï¼š
1. **è§’è‰²æ£€æŸ¥**ï¼š`require_author` ç¡®ä¿åªæœ‰ä½œè€…èƒ½è°ƒç”¨æ­¤ API
2. **æ‰€æœ‰æƒæ£€æŸ¥**ï¼š`article.user_id != current_user.id` ç¡®ä¿åªèƒ½ç¼–è¾‘è‡ªå·±çš„æ–‡ç« 

è¿™ç§"åŒé‡éªŒè¯"æ¨¡å¼åœ¨å®é™…é¡¹ç›®ä¸­éå¸¸é‡è¦ï¼
:::

### 10.6.2 åç«¯ï¼šåˆ é™¤æ–‡ç«  APIï¼ˆDELETE æ–¹æ³•ï¼‰

```python
@app.delete("/api/articles/{article_id}")
def delete_article(
    article_id: int,
    db: Session = Depends(get_db),
    current_user: User = Depends(require_author)
):
    """åˆ é™¤æ–‡ç« """
    article = db.query(Article).filter(Article.id == article_id).first()
    if not article:
        raise HTTPException(status_code=404, detail="æ–‡ç« ä¸å­˜åœ¨")
    
    # æ£€æŸ¥æ‰€æœ‰æƒ
    if article.user_id != current_user.id:
        raise HTTPException(status_code=403, detail="ä½ åªèƒ½åˆ é™¤è‡ªå·±çš„æ–‡ç« ")
    
    db.delete(article)
    db.commit()
    
    return {"message": "åˆ é™¤æˆåŠŸ"}
```

::: tip è½¯åˆ é™¤ vs ç¡¬åˆ é™¤
æˆ‘ä»¬è¿™é‡Œç”¨çš„æ˜¯**ç¡¬åˆ é™¤**â€”â€”æ•°æ®ç›´æ¥ä»æ•°æ®åº“ä¸­ç§»é™¤ã€‚

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸æ¨è**è½¯åˆ é™¤**ï¼š
- ç»™è¡¨æ·»åŠ  `is_deleted` å­—æ®µ
- åˆ é™¤æ—¶åªæ˜¯æŠŠ `is_deleted` è®¾ä¸º True
- æŸ¥è¯¢æ—¶è¿‡æ»¤æ‰ `is_deleted = True` çš„è®°å½•

å¥½å¤„æ˜¯æ•°æ®å¯ä»¥æ¢å¤ï¼Œä¹Ÿæ–¹ä¾¿å®¡è®¡ã€‚è¿™ä¸ªå¯ä»¥ä½œä¸ºç»ƒä¹ æ¥å®ç°ï¼
:::

### 10.6.3 å‰ç«¯ï¼šç¼–è¾‘é¡µé¢

åˆ›å»º `frontend/app/pages/blog/edit/[id].vue`ï¼š

```vue
<!-- frontend/app/pages/blog/edit/[id].vue -->
<template>
  <div class="edit-page">
    <h1>âœï¸ ç¼–è¾‘æ–‡ç« </h1>
    
    <div v-if="pending" class="loading">åŠ è½½ä¸­...</div>
    
    <form v-else @submit.prevent="handleSubmit" class="edit-form">
      <div class="form-group">
        <label for="title">æ–‡ç« æ ‡é¢˜</label>
        <input
          id="title"
          v-model="form.title"
          type="text"
          placeholder="ç»™ä½ çš„æ–‡ç« èµ·ä¸ªæ ‡é¢˜"
          required
        />
      </div>
      
      <div class="form-group">
        <label for="content">æ–‡ç« å†…å®¹ï¼ˆæ”¯æŒ Markdownï¼‰</label>
        <textarea
          id="content"
          v-model="form.content"
          placeholder="å¼€å§‹å†™ä½œ..."
          rows="15"
          required
        ></textarea>
      </div>
      
      <div class="form-group">
        <label for="tags">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
        <input
          id="tags"
          v-model="form.tags"
          type="text"
          placeholder="Vue,å‰ç«¯,æ•™ç¨‹"
        />
      </div>
      
      <div class="form-actions">
        <NuxtLink to="/user/articles" class="btn-cancel">å–æ¶ˆ</NuxtLink>
        <button type="submit" class="btn-submit" :disabled="isSubmitting">
          {{ isSubmitting ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜ä¿®æ”¹' }}
        </button>
      </div>
    </form>
  </div>
</template>

<script setup>
definePageMeta({
  middleware: ['author']
})

const route = useRoute()
const { token } = useAuth()

const articleId = route.params.id

// è·å–æ–‡ç« è¯¦æƒ…
const { data, pending } = await useFetch(`http://localhost:8000/api/articles/${articleId}`)

// è¡¨å•æ•°æ®
const form = reactive({
  title: '',
  content: '',
  tags: ''
})

// å¡«å……è¡¨å•
watch(data, (newData) => {
  if (newData) {
    form.title = newData.title
    form.content = newData.content
    form.tags = newData.tags?.join(',') || ''
  }
}, { immediate: true })

const isSubmitting = ref(false)

async function handleSubmit() {
  isSubmitting.value = true
  
  try {
    await $fetch(`http://localhost:8000/api/articles/${articleId}`, {
      method: 'PUT',
      headers: {
        Authorization: `Bearer ${token.value}`
      },
      body: {
        title: form.title,
        content: form.content,
        tags: form.tags
      }
    })
    
    navigateTo(`/blog/${articleId}`)
  } catch (error) {
    alert('ä¿å­˜å¤±è´¥ï¼š' + (error.data?.detail || 'æœªçŸ¥é”™è¯¯'))
  } finally {
    isSubmitting.value = false
  }
}
</script>

<style scoped>
.edit-page {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

.loading {
  text-align: center;
  padding: 3rem;
  color: #6b7280;
}

.edit-form {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.form-group label {
  font-weight: 500;
  color: #374151;
}

.form-group input,
.form-group textarea {
  padding: 0.75rem 1rem;
  border: 2px solid #e5e7eb;
  border-radius: 0.5rem;
  font-size: 1rem;
  transition: border-color 0.2s;
}

.form-group input:focus,
.form-group textarea:focus {
  outline: none;
  border-color: #667eea;
}

.form-group textarea {
  resize: vertical;
  font-family: 'Monaco', 'Menlo', monospace;
  line-height: 1.6;
}

.form-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
}

.btn-cancel {
  padding: 0.75rem 1.5rem;
  background: #e5e7eb;
  color: #374151;
  text-decoration: none;
  border-radius: 0.5rem;
}

.btn-submit {
  padding: 0.75rem 1.5rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 0.5rem;
  cursor: pointer;
  font-weight: 500;
}

.btn-submit:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
</style>
```

## 10.7 å°ç»“ä¸ç»ƒä¹ 

::: important ğŸ‰ æ­å–œä½ å®Œæˆäº†æƒé™ç³»ç»Ÿï¼
ç°åœ¨ä½ çš„åšå®¢å…·å¤‡äº†ï¼š
- âœ… **ç”¨æˆ·è§’è‰²**ï¼šè¯»è€…å’Œä½œè€…
- âœ… **è·¯ç”±å®ˆå«**ï¼šä¿æŠ¤éœ€è¦æƒé™çš„é¡µé¢
- âœ… **ä¸ªäººä¸­å¿ƒ**ï¼šç”¨æˆ·ç®¡ç†è‡ªå·±çš„ç©ºé—´
- âœ… **æ–‡ç« ç®¡ç†**ï¼šç¼–è¾‘å’Œåˆ é™¤è‡ªå·±çš„æ–‡ç« 

ä½ å·²ç»æŒæ¡äº† RBAC æƒé™æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³ï¼
:::

### æœ¬ç« å›é¡¾

| æ¦‚å¿µ | è¯´æ˜ |
|------|------|
| RBAC | åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œç”¨æˆ· â†’ è§’è‰² â†’ æƒé™ |
| ä¸­é—´ä»¶ | åœ¨è·¯ç”±è·³è½¬å‰æ‰§è¡Œçš„æ£€æŸ¥å‡½æ•° |
| æƒé™åˆ†çº§ | ä¸åŒè§’è‰²æœ‰ä¸åŒçš„èƒ½åŠ› |
| æ‰€æœ‰æƒæ£€æŸ¥ | åªèƒ½æ“ä½œå±äºè‡ªå·±çš„èµ„æº |

### åŠ¨æ‰‹ç»ƒä¹ 

::: tip ç»ƒä¹ æç¤º
åˆ°ç°åœ¨ä½ å·²ç»å­¦ä¼šäº†ç»å¤§éƒ¨åˆ†å†…å®¹ï¼Œä¸‹é¢çš„ç»ƒä¹ é¢˜å°†å¸®åŠ©ä½ å·©å›ºå¹¶æ‰©å±•æ‰€å­¦çŸ¥è¯†ã€‚å¯ä»¥é€‚å½“ä½¿ç”¨ AI è¾…åŠ©ç¼–ç¨‹ï¼Œä½†æ˜¯åˆ‡è®°è¦ç‹¬ç«‹æ€è€ƒï¼
:::

**ç»ƒä¹  1ï¼šå®ç°æ–‡ç« ç½®é¡¶åŠŸèƒ½** â­â­â­

ç»™ Article è¡¨æ·»åŠ  `is_pinned` å­—æ®µï¼Œåªæœ‰ç®¡ç†å‘˜å¯ä»¥ç½®é¡¶/å–æ¶ˆç½®é¡¶æ–‡ç« ã€‚

æç¤ºï¼š
- æ·»åŠ  admin è§’è‰²
- åˆ›å»º `POST /api/articles/{id}/pin` API
- æ–‡ç« åˆ—è¡¨é¡µç½®é¡¶æ–‡ç« æ˜¾ç¤ºåœ¨æœ€å‰é¢

**ç»ƒä¹  2ï¼šå®ç°è½¯åˆ é™¤** â­â­

ç»™ Article è¡¨æ·»åŠ  `is_deleted` å­—æ®µï¼Œåˆ é™¤æ—¶ä¸çœŸæ­£åˆ é™¤ï¼Œè€Œæ˜¯æ ‡è®°ä¸ºå·²åˆ é™¤ã€‚

æç¤ºï¼š
- æ‰€æœ‰æŸ¥è¯¢éƒ½è¦è¿‡æ»¤ `is_deleted = False`
- å¯ä»¥æ·»åŠ "å›æ”¶ç«™"åŠŸèƒ½

::: info ä¸‹ä¸€ç« é¢„å‘Š

æƒé™ç³»ç»Ÿå®Œæˆäº†ï¼Œä½†åšå®¢è¿˜ç¼ºå°‘äº’åŠ¨æ€§â€”â€”è¯»è€…æƒ³è¯„è®ºæ€ä¹ˆåŠï¼Ÿ

ä¸‹ä¸€ç« æˆ‘ä»¬å°†å­¦ä¹ **æ’ä»¶åŒ–æ€ç»´**ï¼Œå®ç°ä¸€ä¸ªå¯ä»¥å¼€å…³çš„è¯„è®ºç³»ç»Ÿï¼

:::
