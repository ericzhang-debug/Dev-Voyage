---
title: ç¬¬ 13 ç« ï¼šæ€§èƒ½ä¼˜åŒ–ä¸è§„èŒƒå›é¡¾
createTime: 2025/12/20 12:00:00
permalink: /fullstack-course/optimization/
---
# ç¬¬ 13 ç« ï¼šæ€§èƒ½ä¼˜åŒ–ä¸è§„èŒƒå›é¡¾

::: important æœ¬ç« å­¦ä¹ ç›®æ ‡
- æŒæ¡ä»£ç è§„èŒƒå·¥å…·ï¼ˆESLintã€Prettierï¼‰
- ç†è§£å‰åç«¯æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- **é‡ç‚¹æŒæ¡å¼‚æ­¥ä¼˜åŒ–æŠ€å·§**
- äº†è§£å®‰å…¨æœ€ä½³å®è·µ
- ğŸ‰ **æˆæœï¼šä»£ç æ›´è§„èŒƒï¼Œç½‘ç«™æ›´å¿«ï¼**
:::

é¡¹ç›®åŠŸèƒ½å®Œæˆäº†ï¼Œçœ‹èµ·æ¥ä¹Ÿä¸é”™ã€‚ä½†çœŸæ­£çš„ä¸“ä¸šå¼€å‘è€…è¿˜ä¼šå…³å¿ƒï¼šä»£ç è´¨é‡å’Œæ€§èƒ½ï¼

::: tip æœ¬ç« ç»“æŸåä½ ä¼šå¾—åˆ°ä»€ä¹ˆ
ä¸€å¥—è§„èŒƒåŒ–çš„ä»£ç ã€æ›´å¿«çš„å“åº”é€Ÿåº¦ã€æ›´å®‰å…¨çš„ç³»ç»Ÿï¼
:::

---

## 13.1 ä»£ç è§„èŒƒåŒ–

### 13.1.1 ä¸ºä»€ä¹ˆéœ€è¦ä»£ç è§„èŒƒï¼Ÿ

::: info å†å²è¶£äº‹ï¼šTab vs Space ä¹‹äº‰
ç¨‹åºå‘˜ç•Œæœ‰ä¸€åœºè‘—åçš„"åœ£æˆ˜"â€”â€”ç”¨ Tab è¿˜æ˜¯ Space ç¼©è¿›ä»£ç ï¼Ÿ

è¿™åœºäº‰è®ºä» 1970 å¹´ä»£æŒç»­è‡³ä»Šã€‚2016 å¹´ï¼ŒGoogle çš„ä¸€é¡¹åˆ†ææ˜¾ç¤ºï¼šä½¿ç”¨ Space çš„å¼€å‘è€…å¹³å‡è–ªèµ„æ¯”ä½¿ç”¨ Tab çš„é«˜ 8%ï¼ˆå½“ç„¶è¿™åªæ˜¯ç›¸å…³æ€§ï¼Œä¸æ˜¯å› æœå…³ç³»ï¼‰ã€‚

æœ€æç¬‘çš„æ˜¯ã€Šç¡…è°·ã€‹ç”µè§†å‰§è¿˜ä¸“é—¨ä¸ºæ­¤åšäº†ä¸€é›†â€”â€”ä¸»è§’å› ä¸ºè¿™ä¸ªé—®é¢˜å’Œå¥³æœ‹å‹åˆ†æ‰‹äº†ï¼

å…¶å®çœŸæ­£é‡è¦çš„ä¸æ˜¯ç”¨å“ªä¸ªï¼Œè€Œæ˜¯**å›¢é˜Ÿç»Ÿä¸€**ã€‚ç°ä»£å·¥å…·è®©è¿™ä¸å†æ˜¯é—®é¢˜ï¼šé…ç½®ä¸€æ¬¡ï¼Œè‡ªåŠ¨æ ¼å¼åŒ–ã€‚
:::

ä»£ç è§„èŒƒçš„å¥½å¤„ï¼š
1. **å›¢é˜Ÿåä½œ**ï¼šæ¯ä¸ªäººå†™çš„ä»£ç é£æ ¼ä¸€è‡´
2. **å‡å°‘é”™è¯¯**ï¼šå·¥å…·å¯ä»¥å‘ç°æ½œåœ¨é—®é¢˜
3. **ä»£ç å®¡æŸ¥**ï¼šä¸ç”¨äº‰è®ºé£æ ¼é—®é¢˜
4. **å¯ç»´æŠ¤æ€§**ï¼šå‡ ä¸ªæœˆåè‡ªå·±ä¹Ÿèƒ½çœ‹æ‡‚

### 13.1.2 ESLintï¼šä»£ç æ£€æŸ¥å™¨

ESLint æ˜¯ JavaScript/TypeScript æœ€æµè¡Œçš„ä»£ç æ£€æŸ¥å·¥å…·ã€‚

**åœ¨å‰ç«¯é¡¹ç›®ä¸­å®‰è£…ï¼š**

```bash
cd frontend
npm install -D eslint @nuxtjs/eslint-config-typescript
```

**åˆ›å»ºé…ç½®æ–‡ä»¶ `.eslintrc.cjs`ï¼š**

```javascript
// frontend/.eslintrc.cjs
module.exports = {
  root: true,
  extends: [
    '@nuxtjs/eslint-config-typescript'
  ],
  rules: {
    // è‡ªå®šä¹‰è§„åˆ™
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'error' : 'off',
    
    // Vue ç›¸å…³è§„åˆ™
    'vue/multi-word-component-names': 'off',
    'vue/no-multiple-template-root': 'off',
    
    // TypeScript ç›¸å…³
    '@typescript-eslint/no-unused-vars': ['warn', { argsIgnorePattern: '^_' }],
  }
}
```

**æ·»åŠ è„šæœ¬åˆ° `package.json`ï¼š**

```json
{
  "scripts": {
    "lint": "eslint --ext .ts,.js,.vue .",
    "lint:fix": "eslint --ext .ts,.js,.vue . --fix"
  }
}
```

### 13.1.3 Prettierï¼šä»£ç æ ¼å¼åŒ–å™¨

Prettier ä¸“æ³¨äºä»£ç æ ¼å¼åŒ–ï¼Œä¸ ESLint é…åˆä½¿ç”¨æ•ˆæœæœ€ä½³ã€‚

**å®‰è£… Prettierï¼š**

```bash
npm install -D prettier eslint-config-prettier eslint-plugin-prettier
```

**åˆ›å»ºé…ç½®æ–‡ä»¶ `.prettierrc`ï¼š**

```json
{
  "semi": false,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 100,
  "vueIndentScriptAndStyle": true
}
```

**æ›´æ–° ESLint é…ç½®ä»¥é›†æˆ Prettierï¼š**

```javascript
// frontend/.eslintrc.cjs
module.exports = {
  root: true,
  extends: [
    '@nuxtjs/eslint-config-typescript',
    'prettier'  // æ·»åŠ  prettierï¼Œæ”¾åœ¨æœ€å
  ],
  plugins: ['prettier'],
  rules: {
    'prettier/prettier': 'warn',
    // ... å…¶ä»–è§„åˆ™
  }
}
```

### 13.1.4 Python ä»£ç è§„èŒƒ

åç«¯é¡¹ç›®ä¹Ÿéœ€è¦ä»£ç è§„èŒƒï¼

**å®‰è£…å·¥å…·ï¼š**

```bash
cd backend
pip install black isort flake8
```

**é…ç½®æ–‡ä»¶ `pyproject.toml`ï¼š**

```toml
# backend/pyproject.toml

[tool.black]
line-length = 88
target-version = ['py311']
include = '\.pyi?$'

[tool.isort]
profile = "black"
line_length = 88

[tool.flake8]
max-line-length = 88
extend-ignore = ["E203", "E501"]
```

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
# æ ¼å¼åŒ–ä»£ç 
black .

# æ’åº import
isort .

# æ£€æŸ¥ä»£ç 
flake8 .
```
::: tip å…³äºruff
ruff æ˜¯ä¸€ä¸ª Python ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œä¸ black ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯ç”±Rustå†™çš„ã€‚å®ƒçš„ä¼˜åŠ¿åœ¨äºï¼š
- é€Ÿåº¦å¿«ï¼ˆæ¯” black å¿« 2-3 å€ï¼‰
- é…ç½®ç®€å•ï¼ˆæ— éœ€ pyproject.tomlï¼‰
- æ”¯æŒæ’ä»¶ç³»ç»Ÿï¼ˆå¦‚ flake8 æ’ä»¶ï¼‰

ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ ruff æ›¿ä»£ black å’Œ flake8ï¼Œå…·ä½“ç”¨æ³•è¯·å‚è€ƒ [ruff å®˜æ–¹æ–‡æ¡£](https://ruff.rs/)ã€‚
:::

::: tip VS Code è‡ªåŠ¨æ ¼å¼åŒ–
åœ¨ VS Code ä¸­å®‰è£… ESLintã€Prettier å’Œ Python æ‰©å±•ï¼Œè®¾ç½®ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼š

```json
// .vscode/settings.json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "[python]": {
    "editor.defaultFormatter": "ms-python.black-formatter"
  }
}
```

è¿™æ ·æ¯æ¬¡ä¿å­˜æ–‡ä»¶æ—¶ï¼Œä»£ç éƒ½ä¼šè‡ªåŠ¨æ ¼å¼åŒ–ï¼
:::

## 13.2 é¡¹ç›®ç»“æ„æœ€ä½³å®è·µ

### 13.2.1 å‰ç«¯é¡¹ç›®ç»“æ„

è‰¯å¥½çš„é¡¹ç›®ç»“æ„è®©ä»£ç æ›´æ˜“ç»´æŠ¤ï¼š

```
frontend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ assets/           # é™æ€èµ„æºï¼ˆCSSã€å›¾ç‰‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”‚   â””â”€â”€ variables.css
â”‚   â”‚   â””â”€â”€ images/
â”‚   â”‚
â”‚   â”œâ”€â”€ components/       # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/       # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ Card.vue
â”‚   â”‚   â”‚   â””â”€â”€ Modal.vue
â”‚   â”‚   â”œâ”€â”€ article/      # æ–‡ç« ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ArticleCard.vue
â”‚   â”‚   â”‚   â””â”€â”€ ArticleContent.vue
â”‚   â”‚   â””â”€â”€ layout/       # å¸ƒå±€ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ NavBar.vue
â”‚   â”‚       â””â”€â”€ Footer.vue
â”‚   â”‚
â”‚   â”œâ”€â”€ composables/      # å¯ç»„åˆå‡½æ•°
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useApi.ts
â”‚   â”‚   â””â”€â”€ useFeature.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/       # è·¯ç”±ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ auth.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/           # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ index.vue
â”‚   â”‚   â”œâ”€â”€ blog/
â”‚   â”‚   â””â”€â”€ user/
â”‚   â”‚
â”‚   â”œâ”€â”€ types/           # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â””â”€â”€ models.ts
â”‚   â”‚
â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ format.ts
â”‚       â””â”€â”€ validation.ts
â”‚
â”œâ”€â”€ nuxt.config.ts
â””â”€â”€ package.json
```

### 13.2.2 åç«¯é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py           # åº”ç”¨å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ api/              # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ articles.py
â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â””â”€â”€ comments.py
â”‚   â”‚
â”‚   â”œâ”€â”€ core/             # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py     # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ security.py   # å®‰å…¨ç›¸å…³
â”‚   â”‚   â””â”€â”€ database.py   # æ•°æ®åº“é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ article.py
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/          # Pydantic æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ article.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ article_service.py
â”‚   â”‚   â””â”€â”€ user_service.py
â”‚   â”‚
â”‚   â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ helpers.py
â”‚
â”œâ”€â”€ tests/                # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_api.py
â”‚
â”œâ”€â”€ requirements.txt
â””â”€â”€ pyproject.toml
```

### 13.2.3 å‘½åè§„èŒƒ

**æ–‡ä»¶å‘½åï¼š**
- Vue ç»„ä»¶ï¼š`PascalCase.vue`ï¼ˆå¦‚ `ArticleCard.vue`ï¼‰
- JavaScript/TypeScriptï¼š`camelCase.ts`ï¼ˆå¦‚ `useAuth.ts`ï¼‰
- Pythonï¼š`snake_case.py`ï¼ˆå¦‚ `article_service.py`ï¼‰
- CSS/æ ·å¼ï¼š`kebab-case.css`ï¼ˆå¦‚ `main-style.css`ï¼‰

**ä»£ç å‘½åï¼š**
| ç±»å‹ | JavaScript/TypeScript | Python |
|------|---------------------|--------|
| å˜é‡/å‡½æ•° | camelCase | snake_case |
| ç±» | PascalCase | PascalCase |
| å¸¸é‡ | UPPER_SNAKE_CASE | UPPER_SNAKE_CASE |
| ç§æœ‰å˜é‡ | _camelCase | _snake_case |

## 13.3 å‰ç«¯æ€§èƒ½ä¼˜åŒ–

### 13.3.1 æ‡’åŠ è½½ä¸ä»£ç åˆ†å‰²

Nuxt é»˜è®¤æŒ‰è·¯ç”±è¿›è¡Œä»£ç åˆ†å‰²ï¼Œä½†æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š

**ç»„ä»¶æ‡’åŠ è½½ï¼š**

```vue
<script setup>
// æ‡’åŠ è½½ç»„ä»¶ï¼ˆä¸ä¼šåŒ…å«åœ¨åˆå§‹ bundle ä¸­ï¼‰
const HeavyChart = defineAsyncComponent(() => 
  import('~/components/HeavyChart.vue')
)

// å¸¦åŠ è½½çŠ¶æ€çš„æ‡’åŠ è½½
const CommentList = defineAsyncComponent({
  loader: () => import('~/components/CommentList.vue'),
  loadingComponent: SkeletonComment,
  delay: 200,  // å»¶è¿Ÿæ˜¾ç¤ºåŠ è½½çŠ¶æ€
  timeout: 5000
})
</script>
```

**è·¯ç”±æ‡’åŠ è½½ï¼ˆNuxt å·²è‡ªåŠ¨æ”¯æŒï¼‰ï¼š**

```typescript
// Nuxt è‡ªåŠ¨å°†æ¯ä¸ª pages/ ä¸‹çš„æ–‡ä»¶ä½œä¸ºç‹¬ç«‹ chunk
// åªæœ‰è®¿é—®è¯¥è·¯ç”±æ—¶æ‰ä¼šåŠ è½½å¯¹åº”ä»£ç 
```

### 13.3.2 å›¾ç‰‡ä¼˜åŒ–

```vue
<template>
  <!-- ä½¿ç”¨ Nuxt Image ç»„ä»¶ -->
  <NuxtImg
    src="/images/hero.jpg"
    width="800"
    height="400"
    loading="lazy"
    format="webp"
    sizes="(max-width: 768px) 100vw, 800px"
  />
</template>
```

**å®‰è£… Nuxt Imageï¼š**

```bash
npm install @nuxt/image
```

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: ['@nuxt/image'],
  image: {
    quality: 80,
    format: ['webp', 'jpg']
  }
})
```

### 13.3.3 é˜²æŠ–ä¸èŠ‚æµ

::: tip ä»€ä¹ˆæ˜¯é˜²æŠ–å’ŒèŠ‚æµï¼Ÿ
- **é˜²æŠ–ï¼ˆDebounceï¼‰**ï¼šç­‰ç”¨æˆ·åœæ­¢æ“ä½œåå†æ‰§è¡Œã€‚æ¯”å¦‚æœç´¢æ¡†è¾“å…¥ï¼Œç­‰åœæ­¢è¾“å…¥ 300ms åæ‰å‘è¯·æ±‚ã€‚
- **èŠ‚æµï¼ˆThrottleï¼‰**ï¼šé™åˆ¶æ‰§è¡Œé¢‘ç‡ã€‚æ¯”å¦‚æ»šåŠ¨äº‹ä»¶ï¼Œæ¯ 100ms æœ€å¤šæ‰§è¡Œä¸€æ¬¡ã€‚
:::

**å®ç°é˜²æŠ–å‡½æ•°ï¼š**

```typescript
// frontend/app/utils/debounce.ts

export function debounce<T extends (...args: any[]) => any>(
  fn: T,
  delay: number
): (...args: Parameters<T>) => void {
  let timer: ReturnType<typeof setTimeout> | null = null
  
  return function (...args: Parameters<T>) {
    if (timer) {
      clearTimeout(timer)
    }
    timer = setTimeout(() => {
      fn(...args)
      timer = null
    }, delay)
  }
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šæœç´¢æ¡†
const searchInput = ref('')
const searchResults = ref([])

const doSearch = debounce(async (keyword: string) => {
  const { data } = await useFetch(`/api/search?q=${keyword}`)
  searchResults.value = data.value
}, 300)

watch(searchInput, (newValue) => {
  if (newValue.length >= 2) {
    doSearch(newValue)
  }
})
```

**å®ç°èŠ‚æµå‡½æ•°ï¼š**

```typescript
// frontend/app/utils/throttle.ts

export function throttle<T extends (...args: any[]) => any>(
  fn: T,
  interval: number
): (...args: Parameters<T>) => void {
  let lastTime = 0
  
  return function (...args: Parameters<T>) {
    const now = Date.now()
    if (now - lastTime >= interval) {
      fn(...args)
      lastTime = now
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šæ»šåŠ¨åŠ è½½
const handleScroll = throttle(() => {
  const { scrollTop, scrollHeight, clientHeight } = document.documentElement
  if (scrollTop + clientHeight >= scrollHeight - 100) {
    loadMoreArticles()
  }
}, 100)

onMounted(() => {
  window.addEventListener('scroll', handleScroll)
})

onUnmounted(() => {
  window.removeEventListener('scroll', handleScroll)
})
```

## 13.4 åç«¯æ€§èƒ½ä¼˜åŒ–

### 13.4.1 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

**é—®é¢˜ï¼šN+1 æŸ¥è¯¢**

```python
# âŒ ç³Ÿç³•çš„ä»£ç ï¼šN+1 æŸ¥è¯¢é—®é¢˜
@router.get("/articles")
def get_articles(db: Session = Depends(get_db)):
    articles = db.query(Article).all()  # 1 æ¬¡æŸ¥è¯¢
    result = []
    for article in articles:
        author = db.query(User).get(article.author_id)  # N æ¬¡æŸ¥è¯¢ï¼
        result.append({
            "title": article.title,
            "author": author.username
        })
    return result
```

```python
# âœ… ä¼˜åŒ–åï¼šä½¿ç”¨ joinedload é¢„åŠ è½½
from sqlalchemy.orm import joinedload

@router.get("/articles")
def get_articles(db: Session = Depends(get_db)):
    articles = db.query(Article)\
        .options(joinedload(Article.author))\
        .all()  # åªæœ‰ 1-2 æ¬¡æŸ¥è¯¢
    
    return [
        {
            "title": a.title,
            "author": a.author.username
        }
        for a in articles
    ]
```

**æ·»åŠ æ•°æ®åº“ç´¢å¼•ï¼š**

```python
# models/article.py
class Article(Base):
    __tablename__ = "articles"
    
    id = Column(Integer, primary_key=True)
    title = Column(String(200), nullable=False)
    author_id = Column(Integer, ForeignKey("users.id"), index=True)  # æ·»åŠ ç´¢å¼•
    created_at = Column(DateTime, default=datetime.utcnow, index=True)  # æ·»åŠ ç´¢å¼•
    status = Column(String(20), index=True)
    
    # å¤åˆç´¢å¼•
    __table_args__ = (
        Index('idx_author_status', 'author_id', 'status'),
    )
```

### 13.4.2 åˆ†é¡µæŸ¥è¯¢

**ä¸è¦ä¸€æ¬¡è¿”å›æ‰€æœ‰æ•°æ®ï¼**

```python
# api/articles.py
from fastapi import Query

@router.get("/articles")
def get_articles(
    page: int = Query(1, ge=1),
    page_size: int = Query(10, ge=1, le=100),
    db: Session = Depends(get_db)
):
    # è®¡ç®—åç§»é‡
    offset = (page - 1) * page_size
    
    # è·å–æ€»æ•°
    total = db.query(Article).filter(Article.status == "published").count()
    
    # åˆ†é¡µæŸ¥è¯¢
    articles = db.query(Article)\
        .filter(Article.status == "published")\
        .order_by(Article.created_at.desc())\
        .offset(offset)\
        .limit(page_size)\
        .all()
    
    return {
        "items": articles,
        "total": total,
        "page": page,
        "page_size": page_size,
        "total_pages": (total + page_size - 1) // page_size
    }
```

**å‰ç«¯åˆ†é¡µç»„ä»¶ï¼š**

```vue
<!-- frontend/app/components/Pagination.vue -->
<template>
  <div class="pagination">
    <button 
      @click="$emit('change', currentPage - 1)"
      :disabled="currentPage <= 1"
      class="page-btn"
    >
      ä¸Šä¸€é¡µ
    </button>
    
    <span class="page-info">
      ç¬¬ {{ currentPage }} / {{ totalPages }} é¡µ
    </span>
    
    <button 
      @click="$emit('change', currentPage + 1)"
      :disabled="currentPage >= totalPages"
      class="page-btn"
    >
      ä¸‹ä¸€é¡µ
    </button>
  </div>
</template>

<script setup>
defineProps<{
  currentPage: number
  totalPages: number
}>()

defineEmits<{
  (e: 'change', page: number): void
}>()
</script>
```

## 13.5 å¼‚æ­¥ä¼˜åŒ–ï¼šè®©ç¨‹åºæ›´å¿«

::: important ğŸ”¥ é‡ç‚¹ç« èŠ‚
å¼‚æ­¥ç¼–ç¨‹æ˜¯ç°ä»£ Web å¼€å‘çš„æ ¸å¿ƒæŠ€èƒ½ã€‚æŒæ¡å¥½å¼‚æ­¥ä¼˜åŒ–ï¼Œå¯ä»¥è®©ä½ çš„åº”ç”¨å“åº”é€Ÿåº¦æå‡æ•°å€ï¼
:::

### 13.5.1 ç†è§£ Python å¼‚æ­¥ç¼–ç¨‹

::: info å†å²è¶£äº‹ï¼šPython async/await çš„è¯ç”Ÿ
Python çš„å¼‚æ­¥ç¼–ç¨‹ç»å†äº†æ¼«é•¿çš„æ¼”è¿›ï¼š
- **2001**ï¼šgenerator ç”Ÿæˆå™¨è¯ç”Ÿ
- **2014**ï¼š`asyncio` åº“åŠ å…¥æ ‡å‡†åº“
- **2015**ï¼šPython 3.5 å¼•å…¥ `async/await` è¯­æ³•

åœ¨æ­¤ä¹‹å‰ï¼ŒPython ç¨‹åºå‘˜ç”¨å›è°ƒåœ°ç‹±å¤„ç†å¹¶å‘ï¼Œä»£ç å¯è¯»æ€§æå·®ã€‚`async/await` è®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥å’ŒåŒæ­¥ä»£ç ä¸€æ ·æ¸…æ™°ï¼

å¦‚ä»Š FastAPI ç­‰ç°ä»£æ¡†æ¶éƒ½åŸºäº `asyncio` æ„å»ºï¼Œå……åˆ†åˆ©ç”¨å¼‚æ­¥çš„ä¼˜åŠ¿ã€‚
:::

**åŒæ­¥ vs å¼‚æ­¥ï¼šä¸€ä¸ªæ¯”å–»**

æƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤ï¼š
- **åŒæ­¥æ–¹å¼**ï¼šæœåŠ¡å‘˜ç«™åœ¨ä½ æ¡Œè¾¹ç­‰ä½ åƒå®Œï¼Œæ‰å»æœåŠ¡ä¸‹ä¸€æ¡Œã€‚
- **å¼‚æ­¥æ–¹å¼**ï¼šæœåŠ¡å‘˜ç»™ä½ ä¸Šèœåå°±å»æœåŠ¡å…¶ä»–æ¡Œï¼Œä½ åƒå®Œå«ä»–å†æ¥ã€‚

**FastAPI ä¸­çš„å¼‚æ­¥è·¯ç”±ï¼š**

```python
# âŒ åŒæ­¥æ–¹å¼ï¼šä¼šé˜»å¡å…¶ä»–è¯·æ±‚
@router.get("/slow")
def slow_endpoint():
    import time
    time.sleep(3)  # å‡è®¾è¿™æ˜¯ä¸€ä¸ªè€—æ—¶æ“ä½œ
    return {"message": "done"}

# âœ… å¼‚æ­¥æ–¹å¼ï¼šä¸ä¼šé˜»å¡
@router.get("/fast")
async def fast_endpoint():
    import asyncio
    await asyncio.sleep(3)  # å¼‚æ­¥ç­‰å¾…ï¼ŒæœŸé—´å¯ä»¥å¤„ç†å…¶ä»–è¯·æ±‚
    return {"message": "done"}
```

### 13.5.2 asyncio.gatherï¼šå¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡

å½“ä½ éœ€è¦åŒæ—¶æ‰§è¡Œå¤šä¸ªç‹¬ç«‹çš„å¼‚æ­¥æ“ä½œæ—¶ï¼Œ`asyncio.gather` æ˜¯ä½ çš„å¥½å¸®æ‰‹ï¼š

```python
import asyncio
from httpx import AsyncClient

# âŒ ä¸²è¡Œè¯·æ±‚ï¼š3ä¸ªè¯·æ±‚æ€»å…±éœ€è¦ 3 ç§’
async def fetch_data_serial():
    async with AsyncClient() as client:
        user = await client.get("http://api.example.com/user")      # 1ç§’
        posts = await client.get("http://api.example.com/posts")    # 1ç§’
        comments = await client.get("http://api.example.com/comments")  # 1ç§’
    return user, posts, comments  # æ€»å…± 3 ç§’

# âœ… å¹¶è¡Œè¯·æ±‚ï¼š3ä¸ªè¯·æ±‚åªéœ€è¦ 1 ç§’
async def fetch_data_parallel():
    async with AsyncClient() as client:
        user, posts, comments = await asyncio.gather(
            client.get("http://api.example.com/user"),
            client.get("http://api.example.com/posts"),
            client.get("http://api.example.com/comments")
        )
    return user, posts, comments  # æ€»å…±çº¦ 1 ç§’
```

**å®é™…åº”ç”¨ï¼šç”¨æˆ·è¯¦æƒ…é¡µèšåˆæ¥å£**

```python
# api/user_detail.py
import asyncio
from httpx import AsyncClient

@router.get("/users/{user_id}/detail")
async def get_user_detail(user_id: int, db: Session = Depends(get_db)):
    """
    è·å–ç”¨æˆ·è¯¦æƒ…ï¼ŒåŒ…æ‹¬åŸºæœ¬ä¿¡æ¯ã€æ–‡ç« æ•°ã€è¯„è®ºæ•°ã€å…³æ³¨æ•°
    ä½¿ç”¨ asyncio.gather å¹¶è¡ŒæŸ¥è¯¢ï¼Œå¤§å¹…æå‡å“åº”é€Ÿåº¦
    """
    
    # å®šä¹‰å„ä¸ªæŸ¥è¯¢ä»»åŠ¡
    async def get_user_info():
        return db.query(User).get(user_id)
    
    async def get_article_count():
        return db.query(Article).filter(Article.author_id == user_id).count()
    
    async def get_comment_count():
        return db.query(Comment).filter(Comment.user_id == user_id).count()
    
    async def get_recent_articles():
        return db.query(Article)\
            .filter(Article.author_id == user_id)\
            .order_by(Article.created_at.desc())\
            .limit(5)\
            .all()
    
    # å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰æŸ¥è¯¢
    user, article_count, comment_count, recent_articles = await asyncio.gather(
        asyncio.to_thread(get_user_info),      # åœ¨çº¿ç¨‹ä¸­è¿è¡ŒåŒæ­¥ä»£ç 
        asyncio.to_thread(get_article_count),
        asyncio.to_thread(get_comment_count),
        asyncio.to_thread(get_recent_articles)
    )
    
    if not user:
        raise HTTPException(status_code=404, detail="User not found")
    
    return {
        "user": {
            "id": user.id,
            "username": user.username,
            "avatar": user.avatar_url
        },
        "stats": {
            "articles": article_count,
            "comments": comment_count
        },
        "recent_articles": recent_articles
    }
```

::: warning asyncio.to_thread çš„ä½œç”¨
`asyncio.to_thread()` æŠŠåŒæ­¥ä»£ç ï¼ˆå¦‚ SQLAlchemy æŸ¥è¯¢ï¼‰æ”¾åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œé¿å…é˜»å¡äº‹ä»¶å¾ªç¯ã€‚

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯åŸç”Ÿæ”¯æŒå¼‚æ­¥çš„åº“ï¼ˆå¦‚ `asyncpg`ã€`httpx`ï¼‰ï¼Œå¯ä»¥ç›´æ¥ awaitï¼Œä¸éœ€è¦ `to_thread`ã€‚
:::

### 13.5.3 é”™è¯¯å¤„ç†ï¼šgather çš„å®‰å…¨ä½¿ç”¨

```python
# é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•ä¸€ä¸ªä»»åŠ¡å¤±è´¥éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸
try:
    results = await asyncio.gather(
        task1(),
        task2(),
        task3()
    )
except Exception as e:
    print(f"æœ‰ä»»åŠ¡å¤±è´¥äº†: {e}")

# ä½¿ç”¨ return_exceptions=Trueï¼Œå¤±è´¥çš„ä»»åŠ¡è¿”å›å¼‚å¸¸å¯¹è±¡è€Œä¸æ˜¯æŠ›å‡º
results = await asyncio.gather(
    task1(),
    task2(),
    task3(),
    return_exceptions=True
)

for i, result in enumerate(results):
    if isinstance(result, Exception):
        print(f"ä»»åŠ¡ {i} å¤±è´¥: {result}")
    else:
        print(f"ä»»åŠ¡ {i} æˆåŠŸ: {result}")
```

### 13.5.4 å‰ç«¯å¼‚æ­¥ä¼˜åŒ–ï¼šPromise.all

JavaScript ä¸­å¯¹åº”çš„æ˜¯ `Promise.all`ï¼š

```typescript
// frontend/app/composables/useUserDetail.ts

export const useUserDetail = (userId: number) => {
  const user = ref(null)
  const stats = ref(null)
  const recentArticles = ref([])
  const loading = ref(true)
  const error = ref(null)
  
  const fetchData = async () => {
    loading.value = true
    
    try {
      // âŒ ä¸²è¡Œè¯·æ±‚ï¼ˆæ…¢ï¼‰
      // const userRes = await $fetch(`/api/users/${userId}`)
      // const statsRes = await $fetch(`/api/users/${userId}/stats`)
      // const articlesRes = await $fetch(`/api/users/${userId}/articles`)
      
      // âœ… å¹¶è¡Œè¯·æ±‚ï¼ˆå¿«ï¼‰
      const [userRes, statsRes, articlesRes] = await Promise.all([
        $fetch(`/api/users/${userId}`),
        $fetch(`/api/users/${userId}/stats`),
        $fetch(`/api/users/${userId}/articles?limit=5`)
      ])
      
      user.value = userRes
      stats.value = statsRes
      recentArticles.value = articlesRes
    } catch (e) {
      error.value = e
    } finally {
      loading.value = false
    }
  }
  
  return {
    user,
    stats,
    recentArticles,
    loading,
    error,
    fetchData
  }
}
```

**Promise.allSettledï¼šç­‰å¾…æ‰€æœ‰å®Œæˆï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰**

```typescript
// å³ä½¿éƒ¨åˆ†è¯·æ±‚å¤±è´¥ï¼Œä¹Ÿèƒ½è·å–å…¶ä»–è¯·æ±‚çš„ç»“æœ
const results = await Promise.allSettled([
  fetch('/api/user'),
  fetch('/api/posts'),
  fetch('/api/comments')
])

results.forEach((result, index) => {
  if (result.status === 'fulfilled') {
    console.log(`è¯·æ±‚ ${index} æˆåŠŸ:`, result.value)
  } else {
    console.log(`è¯·æ±‚ ${index} å¤±è´¥:`, result.reason)
  }
})
```

### 13.5.5 è¶…æ—¶æ§åˆ¶

**Pythonï¼š**

```python
import asyncio

async def fetch_with_timeout():
    try:
        result = await asyncio.wait_for(
            slow_operation(),
            timeout=5.0  # 5ç§’è¶…æ—¶
        )
        return result
    except asyncio.TimeoutError:
        print("æ“ä½œè¶…æ—¶")
        return None
```

**JavaScriptï¼š**

```typescript
// è‡ªå®šä¹‰è¶…æ—¶å‡½æ•°
function withTimeout<T>(promise: Promise<T>, ms: number): Promise<T> {
  const timeout = new Promise<never>((_, reject) => {
    setTimeout(() => reject(new Error('Timeout')), ms)
  })
  return Promise.race([promise, timeout])
}

// ä½¿ç”¨
try {
  const data = await withTimeout(
    fetch('/api/slow-endpoint'),
    5000  // 5ç§’è¶…æ—¶
  )
} catch (e) {
  if (e.message === 'Timeout') {
    console.log('è¯·æ±‚è¶…æ—¶')
  }
}
```

## 13.6 å®‰å…¨æœ€ä½³å®è·µ

### 13.6.1 è¾“å…¥éªŒè¯

**æ°¸è¿œä¸è¦ä¿¡ä»»ç”¨æˆ·è¾“å…¥ï¼**

```python
# âŒ å±é™©ï¼šSQL æ³¨å…¥
@router.get("/search")
def search(keyword: str, db: Session = Depends(get_db)):
    # æ°¸è¿œä¸è¦è¿™æ ·åšï¼
    query = f"SELECT * FROM articles WHERE title LIKE '%{keyword}%'"
    return db.execute(query).fetchall()

# âœ… å®‰å…¨ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
@router.get("/search")
def search(keyword: str, db: Session = Depends(get_db)):
    return db.query(Article)\
        .filter(Article.title.contains(keyword))\
        .all()
```

**ä½¿ç”¨ Pydantic éªŒè¯è¾“å…¥ï¼š**

```python
from pydantic import BaseModel, validator, EmailStr
from typing import Optional

class UserCreate(BaseModel):
    username: str
    email: EmailStr
    password: str
    
    @validator('username')
    def username_valid(cls, v):
        if len(v) < 3 or len(v) > 20:
            raise ValueError('ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨ 3-20 ä¹‹é—´')
        if not v.isalnum():
            raise ValueError('ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯å’Œæ•°å­—')
        return v
    
    @validator('password')
    def password_strong(cls, v):
        if len(v) < 8:
            raise ValueError('å¯†ç è‡³å°‘ 8 ä½')
        if not any(c.isupper() for c in v):
            raise ValueError('å¯†ç å¿…é¡»åŒ…å«å¤§å†™å­—æ¯')
        if not any(c.isdigit() for c in v):
            raise ValueError('å¯†ç å¿…é¡»åŒ…å«æ•°å­—')
        return v
```

### 13.6.2 XSS é˜²æŠ¤

å‰ç«¯æ˜¾ç¤ºç”¨æˆ·å†…å®¹æ—¶è¦é˜²æ­¢ XSS æ”»å‡»ï¼š

```vue
<template>
  <!-- âŒ å±é™©ï¼šç›´æ¥æ¸²æŸ“ HTML -->
  <div v-html="userComment"></div>
  
  <!-- âœ… å®‰å…¨ï¼šä½¿ç”¨æ–‡æœ¬æ’å€¼ï¼ˆè‡ªåŠ¨è½¬ä¹‰ï¼‰ -->
  <div>{{ userComment }}</div>
  
  <!-- âœ… å¦‚æœå¿…é¡»æ¸²æŸ“ HTMLï¼Œå…ˆè¿›è¡Œæ¸…ç† -->
  <div v-html="sanitizedHtml"></div>
</template>

<script setup>
import DOMPurify from 'dompurify'

const sanitizedHtml = computed(() => 
  DOMPurify.sanitize(userComment.value)
)
</script>
```

### 13.6.3 æ•æ„Ÿä¿¡æ¯å¤„ç†

```python
# .env æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ° Gitï¼‰
DATABASE_URL=sqlite:///./blog.db
SECRET_KEY=your-super-secret-key-change-this-in-production
JWT_ALGORITHM=HS256

# .gitignore
.env
*.db
__pycache__/
```

```python
# core/config.py
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    database_url: str
    secret_key: str
    jwt_algorithm: str = "HS256"
    
    class Config:
        env_file = ".env"

settings = Settings()
```

## 13.7 å°ç»“ä¸ç»ƒä¹ 

::: important ğŸ‰ æ­å–œä½ å®Œæˆäº†æ€§èƒ½ä¼˜åŒ–ä¸è§„èŒƒå›é¡¾ï¼
ä½ ç°åœ¨æŒæ¡äº†ï¼š
- âœ… **ä»£ç è§„èŒƒ**ï¼šESLint + Prettier è‡ªåŠ¨æ ¼å¼åŒ–
- âœ… **é¡¹ç›®ç»“æ„**ï¼šæ¸…æ™°çš„ç›®å½•ç»„ç»‡
- âœ… **å‰ç«¯ä¼˜åŒ–**ï¼šæ‡’åŠ è½½ã€é˜²æŠ–èŠ‚æµ
- âœ… **åç«¯ä¼˜åŒ–**ï¼šæ•°æ®åº“æŸ¥è¯¢ã€åˆ†é¡µ
- âœ… **å¼‚æ­¥ä¼˜åŒ–**ï¼šasyncio.gatherã€Promise.all
- âœ… **å®‰å…¨å®è·µ**ï¼šè¾“å…¥éªŒè¯ã€XSS é˜²æŠ¤

ä½ çš„é¡¹ç›®ç°åœ¨æ›´ä¸“ä¸šäº†ï¼
:::

### æœ¬ç« å›é¡¾

| æ¦‚å¿µ | è¯´æ˜ |
|------|------|
| ESLint | JavaScript ä»£ç æ£€æŸ¥å·¥å…· |
| Prettier | ä»£ç æ ¼å¼åŒ–å·¥å…· |
| é˜²æŠ–/èŠ‚æµ | æ§åˆ¶å‡½æ•°æ‰§è¡Œé¢‘ç‡ |
| asyncio.gather | Python å¹¶è¡Œå¼‚æ­¥æ‰§è¡Œ |
| Promise.all | JavaScript å¹¶è¡Œå¼‚æ­¥æ‰§è¡Œ |
| N+1 é—®é¢˜ | æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½é™·é˜± |

### åŠ¨æ‰‹ç»ƒä¹ 

**ç»ƒä¹  1ï¼šå®ç°åˆ†é¡µç»„ä»¶** â­â­

å®Œå–„æ–‡ç« åˆ—è¡¨é¡µçš„åˆ†é¡µåŠŸèƒ½ï¼š
- å‰ç«¯åˆ†é¡µç»„ä»¶
- åç«¯åˆ†é¡µ API
- é¡µç å’Œé¡µé¢å¤§å°å¯é…ç½®

**ç»ƒä¹  2ï¼šå¼‚æ­¥ä¼˜åŒ–å®æˆ˜** â­â­â­

ä¼˜åŒ–é¦–é¡µåŠ è½½ï¼š
- ä½¿ç”¨ `asyncio.gather` å¹¶è¡Œè·å–æœ€æ–°æ–‡ç« ã€çƒ­é—¨æ–‡ç« ã€ç»Ÿè®¡æ•°æ®
- ä½¿ç”¨ `Promise.all` åœ¨å‰ç«¯å¹¶è¡Œè¯·æ±‚
- å¯¹æ¯”ä¼˜åŒ–å‰åçš„å“åº”æ—¶é—´

æç¤ºï¼šå¯ä»¥ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Network é¢æ¿æŸ¥çœ‹è¯·æ±‚æ—¶é—´ã€‚

---

::: tip ä¸‹ä¸€ç« é¢„å‘Š

é¡¹ç›®å¼€å‘å®Œæˆäº†ï¼ä½†å®ƒåªèƒ½åœ¨ä½ çš„ç”µè„‘ä¸Šè¿è¡Œ...

ä¸‹ä¸€ç« æˆ‘ä»¬å°†å­¦ä¹ **é¡¹ç›®éƒ¨ç½²**ï¼ŒæŠŠåšå®¢å‘å¸ƒåˆ°äº’è”ç½‘ä¸Šï¼Œè®©å…¨ä¸–ç•Œéƒ½èƒ½è®¿é—®ï¼

:::